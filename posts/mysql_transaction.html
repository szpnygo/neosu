<!doctype html><html lang=zh><meta charset=utf-8><meta name=viewport content="width=device-width"><title>MySQL事务学习 | NeoSuDoc</title><meta name=description content="MySQL事务学习，数据库事务具备四大特性：原子性、一致性、隔离性、持久性。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。"><meta name=keywords content="MySQL事务学习,包括读未提交,Read uncommitted,读提交,read committed,可重复读,repeatable read,串行化,Serializable"><link rel=stylesheet href=https://neosu.info/css/eureka.min.css><script defer src=https://neosu.info/js/eureka.min.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload="this.onload=null,this.rel='stylesheet'"><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/styles/solarized-light.min.css media=print onload="this.media='all',this.onload=null" crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/highlight.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/languages/dart.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/js/all.min.js integrity="sha256-uNYoXefWRqv+PsIF/OflNmwtKM4lStn9yrz2gVl6ymo=" crossorigin></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X media=print onload="this.media='all',this.onload=null" crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js integrity="sha256-Zmpaaj+GXFsPF5WdPArSrnW3b30dovldeKsW00xBVwE=" crossorigin></script><link rel=preconnect href=https://www.google-analytics.com crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-8R8WZNZH6H"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-8R8WZNZH6H')</script><link rel=icon type=image/png sizes=32x32 href=https://neosu.info/images/icon_hu3c4c8b692d5a46ca71b4ca2347fe7b62_98847_32x32_fill_box_center_2.png><link rel=apple-touch-icon sizes=180x180 href=https://neosu.info/images/icon_hu3c4c8b692d5a46ca71b4ca2347fe7b62_98847_180x180_fill_box_center_2.png><meta name=description content="MySQL事务学习"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"博客","item":"https://neosu.info/posts.html"},{"@type":"ListItem","position":2,"name":"MySQL事务学习","item":"https://neosu.info/posts/mysql_transaction.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://neosu.info/posts/mysql_transaction.html"},"headline":"MySQL事务学习 | NeoSuDoc","datePublished":"2021-05-24T22:35:46+08:00","dateModified":"2021-05-24T22:35:46+08:00","wordCount":1323,"publisher":{"@type":"Person","name":"C. Wang","logo":{"@type":"ImageObject","url":"https://neosu.info/images/icon.png"}},"description":"MySQL事务学习"}</script><meta property="og:title" content="MySQL事务学习 | NeoSuDoc"><meta property="og:type" content="article"><meta property="og:image" content="https://neosu.info/images/icon.png"><meta property="og:url" content="https://neosu.info/posts/mysql_transaction.html"><meta property="og:description" content="MySQL事务学习"><meta property="og:locale" content="zh"><meta property="og:site_name" content="NeoSuDoc"><meta property="article:published_time" content="2021-05-24T22:35:46+08:00"><meta property="article:modified_time" content="2021-05-24T22:35:46+08:00"><meta property="article:section" content="posts"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="事务"><body class="flex flex-col min-h-screen"><header class="fixed flex items-center w-full min-h-16 pl-scrollbar z-50 bg-secondary-bg shadow-sm"><div class="w-full max-w-screen-xl mx-auto"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=='Auto'||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName('html')[0].classList.add('dark')</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="mr-6 text-primary-text text-xl font-bold">NeoSuDoc</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:flex-grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:flex-grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/posts.html class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent mr-4">博客</a>
<a href=/docs/server.html class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent mr-4">服务端</a>
<a href=/docs/mobile.html class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent mr-4">移动端</a>
<a href=/docs/leetcode.html class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent mr-4">LeetCode</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col left-0 md:left-auto right-auto md:right-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>浅色</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>深色</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>自动</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById('lightDarkMode');storageColorScheme==null||storageColorScheme=='Auto'?document.addEventListener('DOMContentLoaded',()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change',switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'sun'),element.firstElementChild.classList.add('fa-sun')):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'moon'),element.firstElementChild.classList.add('fa-moon')),document.addEventListener('DOMContentLoaded',()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="flex-grow pt-16"><div class=pl-scrollbar><div class="w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto"><div class="grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12"><div class="col-span-2 lg:col-span-6 bg-secondary-bg rounded px-6 py-8"><h1 class="font-bold text-3xl text-primary-text">MySQL事务学习</h1><div class="flex flex-wrap flex-row items-center mt-2 text-tertiary-text"><div class="mr-6 my-2"><i class="fas fa-calendar mr-1"></i>
<span>2021-05-24</span></div><div class="mr-6 my-2"><i class="fas fa-clock mr-1"></i>
<span>3分钟阅读时长</span></div><div class="mr-6 my-2"><i class="fas fa-folder mr-1"></i>
<a href=https://neosu.info/categories/mysql.html class=hover:text-eureka>MySQL</a></div></div><div class=content><h2 id=mysql事务学习>MySQL事务学习</h2><h3 id=四大特性>四大特性</h3><p>数据库事务具备四大特性：原子性、一致性、隔离性、持久性。</p><ul><li>原子性。一个事务中所有的操作，要么全部完成，那么全部不完成，不会结束在中间某个环节。</li><li>一致性。在事务开始之前和事务结束以后，数据库的完整性没有被破坏。</li><li>隔离性。数据库允许多个并发事务同时对其数据进行读写和修改能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据部一直。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。</li><li>持久性。事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。</li></ul><h3 id=事务控制语句>事务控制语句</h3><ul><li><p>BEGIN 或 START TRANSACTION 显式地<strong>开启一个事务</strong>；</p></li><li><p>COMMIT 也可以使用 COMMIT WORK，不过二者是等价的。<strong>COMMIT会提交事务</strong>，并使已对数据库进行的所有修改成为永久性的；</p></li><li><p>ROLLBACK 也可以使用 ROLLBACKWORK，不过二者是等价的。<strong>回滚会结束用户的事务，并撤销正在进行的所有未提交的修改</strong>；</p></li><li><p>SAVEPOINT identifier，SAVEPOINT 允许在事务中创建一个保存点，一个事务中可以有多个 SAVEPOINT；</p></li><li><p>RELEASE SAVEPOINT identifier 删除一个事务的保存点，当没有指定的保存点时，执行该语句会抛出一个异常；</p></li><li><p>ROLLBACK TO identifier 把事务回滚到标记点；</p></li><li><p><strong>SET TRANSACTION 用来设置事务的隔离级别</strong>。InnoDB 存储引擎提供事务的隔离级别有READ UNCOMMITTED、READ COMMITTED、REPEATABLE READ 和 SERIALIZABLE。</p></li></ul><h3 id=隔离问题>隔离问题</h3><h4 id=脏读>脏读</h4><p>脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时候，另外一个事务也访问这个数据，然后使用这个数据。</p><h4 id=不可重复读>不可重复读</h4><p>是指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一事务中的两次读取数据之间，由于第二个事务的修改，那么第一个事务两次读到的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为不可重复读。</p><h4 id=幻读>幻读</h4><p>是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。</p><blockquote><p>不可重复读的重点是修改： 同样的条件，你读取过的数据，再次读取出来发现值不一样。<br>幻读的重点在于新增或者删除： 同样的条件，第 1 次和第 2 次读出来的记录数不一样。<br>脏读与不可重复读的区别在于：前者读到的是其他事务未提交的数据，后者读到的是其他事务已提交的数据。</p></blockquote><h3 id=事务隔离级别>事务隔离级别</h3><table><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>Read Uncommitted 读未提交</td><td>可能</td><td>可能</td><td>可能</td></tr><tr><td>Read Committed 读提交</td><td>不可能</td><td>可能</td><td>可能</td></tr><tr><td>Repeatable Read 可重复读</td><td>不可能</td><td>不可能</td><td>可能</td></tr><tr><td>Serializable 串行化</td><td>不可能</td><td>不可能</td><td>不可能</td></tr></tbody></table><blockquote><p>读未提交在并发时会导致很多问题，而性能相对于其他隔离级别提高却很有限，因此较少使用。可串行化强制事务串行，并发效率很低，只有当对数据一致性要求极高且可以接受没有并发时使用，因此使用也较少。</p></blockquote><h3 id=实现可重复读>实现可重复读</h3><p>为了解决不可重复读，或者为了实现可重复读，MySQL 采用了 MVVC (多版本并发控制) 的方式。</p><h3 id=实践>实践</h3></div><div class=my-4><a href=https://neosu.info/tags/mysql.html class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#MySQL</a>
<a href=https://neosu.info/tags/%E4%BA%8B%E5%8A%A1.html class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#事务</a></div><div class="flex flex-col md:flex-row md:justify-between -mx-2 mt-4 px-2 pt-4 border-t"><div><span class="block font-bold">上一页</span>
<a href=https://neosu.info/posts/golang-grpc.html class=block>Golang Grpc</a></div><div class="md:text-right mt-4 md:mt-0"><span class="block font-bold">下一页</span>
<a href=https://neosu.info/posts/reading_cognitive_awakening.html class=block>《认知觉醒：开启自我改变的原动力》读书笔记</a></div></div><script id=utterances src=https://utteranc.es/client.js issue-term=og:title repo=szpnygo/neosu theme=preferred-color-scheme crossorigin=anonymous async></script><script>((storageColorScheme=='Auto'||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementById('utterances').setAttribute('theme','github-dark')</script></div><div class=col-span-2><div class="sticky top-16 z-10 hidden lg:block px-6 py-4 bg-primary-bg"><span class="text-lg font-semibold">本页内容</span></div><div class="sticky-toc hidden lg:block px-6 pb-6"><nav id=TableOfContents><ul><li><a href=#mysql事务学习>MySQL事务学习</a><ul><li><a href=#四大特性>四大特性</a></li><li><a href=#事务控制语句>事务控制语句</a></li><li><a href=#隔离问题>隔离问题</a><ul><li><a href=#脏读>脏读</a></li><li><a href=#不可重复读>不可重复读</a></li><li><a href=#幻读>幻读</a></li></ul></li><li><a href=#事务隔离级别>事务隔离级别</a></li><li><a href=#实现可重复读>实现可重复读</a></li><li><a href=#实践>实践</a></li></ul></li></ul></nav></div><script>window.addEventListener('DOMContentLoaded',()=>{enableStickyToc()})</script></div></div><script>document.addEventListener('DOMContentLoaded',()=>{hljs.initHighlightingOnLoad()})</script></div></div></main><footer class=pl-scrollbar><div class="w-full max-w-screen-xl mx-auto"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2021 <a href=https://neosu.info/>NeoSu</a>
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>